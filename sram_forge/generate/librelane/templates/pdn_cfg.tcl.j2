# PDN Configuration
# Generated by sram-forge
# Chip: {{ chip.name }}

# Power grid configuration for GF180MCU with SRAM macros

# Define power nets
set ::power_nets "VDD"
set ::ground_nets "VSS"

# Standard cell power connections
add_global_connection -net VDD -pin_pattern "VDD" -power
add_global_connection -net VSS -pin_pattern "VSS" -ground

# SRAM macro power connections
add_global_connection -net VDD -pin_pattern "VDD" -power -inst_pattern "{{ macro_name }}.*"
add_global_connection -net VSS -pin_pattern "VSS" -ground -inst_pattern "{{ macro_name }}.*"

# Define voltage domains
set_voltage_domain -name CORE -power VDD -ground VSS

# Define standard cell grid
define_pdn_grid -name stdcell_grid -voltage_domains CORE \
    -macro -cells "{{ macro_name }}" \
    -halo {10 10 10 10}

# Core power grid stripes
add_pdn_stripe -layer Metal3 -width 2.0 -pitch 50.0 -offset 2.0 -direction vertical
add_pdn_stripe -layer Metal4 -width 2.0 -pitch 50.0 -offset 2.0 -direction horizontal
add_pdn_stripe -layer Metal5 -width 5.0 -pitch 100.0 -offset 5.0 -direction vertical

# Connect stripes between layers
add_pdn_connect -layers {Metal3 Metal4}
add_pdn_connect -layers {Metal4 Metal5}

# Connect standard cells to grid
add_pdn_connect -layers {Metal1 Metal3} -std_cell_pin_only

# SRAM macro ring around each instance
{% for i in range(fit.count) %}
# Ring for sram_{{ i }}
{% endfor %}
# SRAM rings use Metal3/Metal4 with halo spacing

# IO ring connections
add_pdn_ring -layers {Metal4 Metal5} -widths {5.0 5.0} -spacings {2.0 2.0} -core_offset {10 10}
