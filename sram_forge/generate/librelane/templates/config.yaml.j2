# LibreLane Configuration
# Generated by sram-forge
# Chip: {{ chip.name }}
{% if chip.description %}# {{ chip.description }}{% endif %}

meta:
  version: 3
  flow: Chip

DESIGN_NAME: {{ chip.name }}_top

# Die and core areas [x_min, y_min, x_max, y_max] in microns
DIE_AREA: {{ die_area }}
CORE_AREA: {{ core_area }}

VERILOG_FILES:
  - dir::../src/slot_defines.svh
  - dir::../src/{{ chip.name }}_top.sv
  - dir::../src/{{ chip.name }}_core.sv
  - dir::../src/{{ chip.name }}_sram_array.sv

# Verilog defines
VERILOG_DEFINES:
  - USE_POWER_PINS
  - SLOT_{{ slot_define }}

# Use klayout for smaller GDS files
PRIMARY_GDSII_STREAMOUT_TOOL: klayout

# SDC files
PNR_SDC_FILE: dir::{{ chip.name }}_top.sdc
SIGNOFF_SDC_FILE: dir::{{ chip.name }}_top.sdc
FALLBACK_SDC: dir::{{ chip.name }}_top.sdc

# Power / ground nets
VDD_NETS:
  - VDD
GND_NETS:
  - VSS

# Ignore disconnected modules (IO pads with unused outputs)
IGNORE_DISCONNECTED_MODULES:
  - gf180mcu_fd_io__bi_24t

# Clock configuration
CLOCK_PORT: clk_PAD
CLOCK_NET: clk_pad/Y
CLOCK_PERIOD: {{ clock_period_ns }}  # {{ config.clock.frequency_mhz }} MHz

# Fix hold violations
PL_RESIZER_HOLD_SLACK_MARGIN: 0.35
GRT_RESIZER_HOLD_SLACK_MARGIN: 0.3

# Placement density - lower for more macros
PL_TARGET_DENSITY_PCT: 25
GRT_ALLOW_CONGESTION: true

# Fix antenna violations after DRT
DRT_ANTENNA_REPAIR_ITERS: 10
DRT_ANTENNA_MARGIN: 10

# PDN - Straps
PDN_VWIDTH: 5
PDN_HWIDTH: 5
PDN_VSPACING: 1
PDN_HSPACING: 1
PDN_VPITCH: 75
PDN_HPITCH: 75

# PDN - Core ring
PDN_CORE_RING: true
PDN_CORE_RING_VWIDTH: 25
PDN_CORE_RING_HWIDTH: 25
PDN_CORE_RING_CONNECT_TO_PADS: true
PDN_ENABLE_PINS: false
PDN_CORE_VERTICAL_LAYER: Metal2
PDN_CORE_HORIZONTAL_LAYER: Metal3

# Prevent false positive DRC errors in I/O cells and SRAMs
MAGIC_GDS_FLATGLOB:
  - "*_CDNS_*"
  - "COMP_fill_cell"
  - "Poly2_fill_cell"
  - "*$$*"
  - "M1_N*"
  - "M1_P*"
  - "M2_M1*"
  - "M3_M2*"
  - "nmos_5p0*"
  - "nmos_1p2*"
  - "pmos_5p0*"
  - "pmos_1p2*"
  - "via1_*"
  - "ypass_gate*"
  - "G_ring_*"
  - "dcap_103*"
  - "din_*"
  - "mux821_*"
  - "rdummy_*"
  - "pmoscap_*"
  - "xdec_*"
  - "ypredec*"
  - "xpredec*"
  - "prexdec_*"
  - "xdec8_*"
  - "xdec16_*"
  - "xdec32_*"
  - "sa_*"

# Multiple power pads for one power domain
MAGIC_EXT_UNIQUE: notopports

# Macro definitions
MACROS:
  gf180mcu_ws_ip__id:
    gds:
      - pdk_dir::libs.ref/gf180mcu_ws_ip/gds/gf180mcu_ws_ip__id.gds
    lef:
      - pdk_dir::libs.ref/gf180mcu_ws_ip/lef/gf180mcu_ws_ip__id.lef
    instances:
      chip_id:
        location: [660, 660]
        orientation: N
  gf180mcu_ws_ip__logo:
    gds:
      - pdk_dir::libs.ref/gf180mcu_ws_ip/gds/gf180mcu_ws_ip__logo.gds
    lef:
      - pdk_dir::libs.ref/gf180mcu_ws_ip/lef/gf180mcu_ws_ip__logo.lef
    instances:
      wafer_space_logo:
        location: [660, 1160]
        orientation: N
  {{ macro_name }}:
    gds:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/gds/{{ macro_name }}.gds
    lef:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lef/{{ macro_name }}.lef
    vh:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/verilog/{{ macro_name }}__blackbox.v
    lib:
      "*_tt_025C_5v00":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/{{ macro_name }}__tt_025C_5v00.lib
      "*_ff_n40C_5v50":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/{{ macro_name }}__ff_n40C_5v50.lib
      "*_ss_125C_4v50":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/{{ macro_name }}__ss_125C_4v50.lib
    instances:
      # {{ fit.count }} SRAMs in {{ fit.cols }}x{{ fit.rows }} arrangement
{% for p in placements %}
      i_chip_core.u_sram_array.{{ p.name }}:
        location: [{{ p.x }}, {{ p.y }}]
        orientation: {{ p.orientation }}
{% endfor %}

# Power connections for SRAM macros
PDN_MACRO_CONNECTIONS:
{% for p in placements %}
  - "i_chip_core.u_sram_array.{{ p.name }} VDD VSS VDD VSS"
{% endfor %}

# Halo size around macros
FP_MACRO_HORIZONTAL_HALO: 10
FP_MACRO_VERTICAL_HALO: 10
PDN_HORIZONTAL_HALO: 5
PDN_VERTICAL_HALO: 5

PDN_CFG: dir::pdn_cfg.tcl
